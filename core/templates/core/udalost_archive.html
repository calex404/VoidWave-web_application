<!DOCTYPE html>
<html>
<head>
    <title>Archív Udalostí</title>
</head>
<body>
    {% include 'core/navbar.html' %}
    
    <div style="max-width: 800px; margin: 20px auto;">
        <a href="{% url 'udalost_list' %}" style="display: block; text-align: left; margin-bottom: 20px;">← Späť na Aktuálne Udalosti</a>

        <h1>Archív Udalostí (Už skončené)</h1>
        
        {% if messages %}
            {% for message in messages %}
                <div style="padding: 10px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; margin-bottom: 10px;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        {% for item in udalosti %}
            <div style="border: 1px solid #ccc; padding: 15px; margin-bottom: 20px;">
                
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>{{ item.udalost.nazov }}</strong>
                        <p>Dátum konania: {{ item.udalost.datum_konania|date:"d.m.Y H:i" }}</p>
                    </div>
                    
                    <div>
                        {% if item.uz_som_hodnotil %}
                            <span style="color: green; font-weight: bold;">[Tvoj rating je uložený]</span>
                        {% elif user.is_authenticated %}
                            <a href="{% url 'hodnotenie_create' udalost_id=item.udalost.id %}" 
                               style="background-color: #007bff; color: white; padding: 8px 12px; text-decoration: none; border-radius: 4px;">
                                Pridať Hodnotenie
                            </a>
                        {% endif %}
                    </div>
                </div>
                
                <hr>

                {% if item.priemer %}
                    <p style="font-weight: bold;">⭐ Priemerné hodnotenie: {{ item.priemer }}/10</p>
                {% else %}
                    <p>Ešte nebolo hodnotené.</p>
                {% endif %}

                {% if item.vsetky_hodnotenia %}
                    <h3>Hodnotenia od Komunity ({{ item.vsetky_hodnotenia.count }})</h3>
                    {% for hodnotenie in item.vsetky_hodnotenia %}
                        <div style="padding: 5px 0; border-bottom: 1px dashed #eee;">
                            <strong>{{ hodnotenie.profil.nickname }}</strong> udelil/a: 
                            <span style="color: darkred; font-weight: bold;">{{ hodnotenie.hodnotenie }}/10</span> 
                        </div>
                    {% endfor %}
                {% else %}
                    <p>Zatiaľ žiadne individuálne hodnotenia.</p>
                {% endif %}
            </div>
        {% empty %}
            <p>Archív neobsahuje žiadne minulé udalosti.</p>
        {% endfor %}
    </div>
</body>
</html>
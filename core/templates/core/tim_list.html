{% extends "base.html" %}

{% block title %}Zoznam T√≠mov{% endblock %}

{% block content %}
    <div style="max-width: 900px; margin: 30px auto; padding: 25px; background-color: var(--color-surface); border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.5);">
        
        {% if messages %}
            {% for message in messages %}
                <div style="padding: 15px; margin-bottom: 20px; border-radius: 4px; font-weight: bold; color: white;
                            border: 1px solid rgba(255,255,255,0.1);
                            background-color: {% if message.tags == 'error' or message.tags == 'warning' %}rgba(220, 53, 69, 0.8){% else %}rgba(40, 167, 69, 0.8){% endif %};">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <h1 style="color: var(--color-text-main); margin-bottom: 30px;">üõ°Ô∏è Hern√© T√≠my</h1>

        {% if user.is_authenticated %}
            {% with user_is_member_of_any_team=user.profil.timy_clenom_je.exists %}
                
                {% if not user_is_member_of_any_team or user.is_superuser %}
                    <p onclick="window.location.href='{% url 'tim_create' %}'"
                       style="display: inline-block; margin-bottom: 20px; padding: 10px 15px; 
                              background-color: var(--color-success); color: white; text-decoration: none; 
                              border-radius: 5px; font-weight: bold; cursor: pointer;">
                        + Zalo≈æi≈• vlastn√Ω t√≠m
                    </p>
                {% else %}
                     <div style="background-color: rgba(220, 53, 69, 0.1); border: 1px solid var(--color-reject); padding: 10px; border-radius: 5px; margin-bottom: 20px;">
                        <p style="color: var(--color-reject); margin: 0;">
                            ‚ÑπÔ∏è U≈æ si ƒçlenom t√≠mu. Ak chce≈° zalo≈æi≈• nov√Ω, mus√≠≈° najprv opusti≈• ten aktu√°lny.
                        </p>
                     </div>
                {% endif %}
                
                <hr style="border-color: var(--color-border);">

                {% for tim in timy %}
                    <div style="border: 1px solid var(--color-border); padding: 15px; margin-bottom: 20px; border-radius: 8px; background-color: var(--color-surface);">
                        <h2 style="color: var(--color-orange); margin-top: 0;">{{ tim.nazov }}</h2>
                        <p><strong>√örove≈à t√≠mu:</strong> {{ tim.uroven|default:"1" }}</p>
                        <p style="color: var(--color-text-main);">{{ tim.bio|default:"Bez popisu." }}</p>
                        
                        <p><strong>Poƒçet ƒçlenov:</strong> {{ tim.clenovia.count }}/5</p>
                        
                        <p style="font-size: 0.9em; color: var(--color-text-main);">
                            ƒålenovia: 
                            {% for clen in tim.clenovia.all %}
                                <span style="font-weight: bold; color: {% if clen == user.profil %}var(--color-success){% else %}var(--color-text-main){% endif %};">
                                    {{ clen.nickname }}
                                </span>{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                        
                        <div style="margin-top: 15px; border-top: 1px dashed var(--color-border); padding-top: 10px;">
                            
                            {% if tim in user.profil.timy_clenom_je.all %}
                                 <span style="color: var(--color-success); font-weight: bold; margin-right: 15px;">‚úî Tvoj t√≠m</span>
                                 
                                 <a href="{% url 'tim_leave' tim.id %}" style="color: var(--color-reject); font-weight: bold; text-decoration: none; border: 1px solid var(--color-reject); padding: 5px 10px; border-radius: 4px;">
                                    ‚ùå Opusti≈• t√≠m
                                 </a>
                                 
                            {% elif user_is_member_of_any_team and not user.is_superuser %}
                                 <span style="color: var(--color-gray); font-style: italic;">
                                    (Mus√≠≈° opusti≈• svoj aktu√°lny t√≠m, aby si sa mohol prida≈• sem)
                                 </span>
                                 
                            {% elif tim.clenovia.count >= 5 %}
                                 <span style="color: var(--color-reject); font-weight: bold;">T√≠m je pln√Ω (5/5)</span>
                                 
                            {% else %}
                                 <a href="{% url 'tim_join' tim.id %}" style="color: var(--color-orange-link); text-decoration: underline;">
                                    üëâ Prida≈• sa do tohto t√≠mu
                                </a>
                            {% endif %}
        
                        </div>
                    </div>
                {% empty %}
                    <p style="color: var(--color-text-main);">Zatiaƒæ neboli zalo≈æen√© ≈æiadne t√≠my.</p>
                {% endfor %}

            {% endwith %}
        {% endif %}
    </div>
{% endblock content %}